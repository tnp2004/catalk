---
import Layout from "../../../layouts/Layout.astro";
import type { GetStaticPaths } from "astro";
import { CamelToWords } from "../../../utils/convertStringFormat";
import MessageElement from "../../../components/MessageElement.astro";

export const getStaticPaths = (async () => {
    const res: Promise<ResponseData<string[]>> = await (
        await fetch("http://localhost:8080/api/v1/cats/breeds")
    ).json();
    const breedsRes = await res;
    return breedsRes.data.map((v) => ({ params: { breed: v } }));
}) satisfies GetStaticPaths;

const { breed } = Astro.params;
---

<Layout>
    <div
        class="bg-amber-100 border-4 border-slate-700 w-1/2 mx-auto my-10 rounded shadow-xl overflow-hidden px-1"
    >
        <label class="font-bold pl-1 text-3xl" for="chat-title"
            >{CamelToWords(breed)}</label
        >
        <ul class="h-[60vh] flex flex-col px-2 py-3 overflow-auto">
           <MessageElement message="hi" role="user" />
        </ul>
        <div class="flex mb-2">
            <input
                type="text"
                id="messageInput"
                class="w-full px-2 rounded-md shadow-sm"
                placeholder="Type a message . . ."
                required
            />
            <button id="sendMessageBtn" class="font-bold p-1">send</button>
        </div>
    </div>
</Layout>

<script>
    const SendMessageToAI = async () => {
        const msg = document.getElementById("messageInput") as HTMLInputElement
        const headers: Headers = new Headers();
        headers.set("Content-Type", "application/json");
        headers.set("Accept", "application/json");

        const bodyReq: MessageRequest = {
            messageHistory: [],
            newUserMessage: msg.value,
        };

        const request: RequestInfo = new Request(
            "http://localhost:8080/api/v1/gemini/cats/persian",
            {
                method: "POST",
                headers: headers,
                body: JSON.stringify(bodyReq),
            },
        );
        const res = await fetch(request);
        const b: MessageResponse = await res.json();
        console.log(b);
    };

    
    document.getElementById("sendMessageBtn")?.addEventListener("click", () => SendMessageToAI())
</script>
